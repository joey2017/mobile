<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>诚车堂网</title>
<script src="http://s.17cct.com/v3/js/jquery-1.7.2.min.js"></script>
<script type="text/javascript" src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<style type="text/css">
	.btn_blue,.btn_red{
		width: 100%;
		color: #fff;
		cursor: pointer;
		text-align: center;
	}
	.btn_blue{
		background-color: #1d63f3;
	}
	.wrap{
	width: 81.25%;
	margin: 20px auto;
	background-color: #fff;
	border-radius: 0.5rem;
	padding: 3.125% 6.25% 6.25%;
	font-size: 2.2rem;
	line-height: 3.8rem;
}
.wrap h2{
	font-size: 2.6rem;
	font-weight: normal;
	text-align: center;
}
.userinfo h2{
	text-align: left;
}
.wrap input{
	line-height: 2.5rem;
	border: 0;
	margin: 10px 0;
	width: 100%;
	height: 6.25rem;
	border-radius: 0.5rem;
	font-size: 2.2rem;
	-webkit-appearance:none;
}
.wrap input.lhalf,.wrap input.rhalf{
	width: 45%;
}
.wrap input.rhalf{
	float: right;
}
.wrap input[type="text"]{
	background-color: #f1f3f5;
	width: 80%;
	height: 2.5rem;
	padding: 1.875rem 10%;
}
.wrap input[type="tel"]{
    background-color: #f1f3f5;
    width: 80%;
    height: 2.5rem;
    padding: 1.875rem 10%;
}
.wrap input[type="password"]{
    background-color: #f1f3f5;
    width: 80%;
    height: 2.5rem;
    padding: 1.875rem 10%;
}
</style>
</head>
<body >
<div class="wrap"> 
  <h2>微信测试</h2>	
  	<input type="button" class="btn_blue" onclick="choosecard()"  value="卡券列表"/>
    <input type="button" class="btn_blue" onclick="networktype()"  value="网络类型"/>
    <input type="button" class="btn_blue" onclick="hideOptionMenu()"  value="隐藏右上角"/>
    <input type="button" class="btn_blue" onclick="showOptionMenu()"  value="显示右上角"/>
     <input type="button" class="btn_blue" onclick="starvoice()"  value="开始录音"/>
     <input type="button" class="btn_blue" onclick="stoprecord()"  value="停止录音"/>
     <input type="button" class="btn_blue" onclick="playvoice()"  value="播放录音"/>
     <input type="button" class="btn_blue" onclick="pausevoice()"  value="暂停播放录音"/>
     <input type="button" class="btn_blue" onclick="stopvoice()"  value="停止播放"/>
    <input type="button" class="btn_blue" onclick="openLocation()"  value="查看位置接口"/>
    <input type="button" class="btn_blue" onclick="getlocation()"  value="显示地理位置"/>
  	<input type="button" class="btn_blue" onclick="checkjsapi()"  value="检查是否支持指定接口"/>
  	<input type="button" class="btn_blue" onclick="chooseImg()"  value="选择或者拍照"/>
  	<input type="button" class="btn_blue" onclick="scanQRCode()"  value="扫一扫"/>
</div>
<script type="text/javascript">
var localId='';
	wx.config({
		    debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
		    appId: 'wxbd68bd4fe539eba2', // 必填，公众号的唯一标识
		    timestamp: '<{$time}>', // 必填，生成签名的时间戳
		    nonceStr: '<{$nonceStr}>', // 必填，生成签名的随机串
		    signature:'<{$sign}>',// 必填，签名，见附录1
		    jsApiList: ['checkJsApi','onMenuShareTimeline','onMenuShareAppMessage','onMenuShareQQ','onMenuShareWeibo','hideMenuItems','showMenuItems', 'hideAllNonBaseMenuItem','showAllNonBaseMenuItem','translateVoice','startRecord','stopRecord','onRecordEnd', 'playVoice','pauseVoice','stopVoice','uploadVoice', 'downloadVoice', 'chooseImage','previewImage','uploadImage','downloadImage', 'getNetworkType','openLocation','getLocation','hideOptionMenu', 'showOptionMenu', 'closeWindow',  'scanQRCode',  'chooseWXPay', 'openProductSpecificView','addCard','chooseCard', 'openCard'] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
		});

		wx.ready(function(){
			  // config信息验证后会执行ready方法，所有接口调用都必须在config接口获得结果之后，config是一个客户端的异步操作，所以如果需要在页面加载时就调用相关接口，则须把相关接口放在ready函数中调用来确保正确执行。对于用户触发时才调用的接口，则可以直接调用，不需要放在ready函数中。	
			  wx.onMenuShareTimeline({
			    title: '成为车堂盛世VIP门店', // 分享标题
			    link: 'http://m.17cct.com/index/index.html', // 分享链接
			    imgUrl: 'http://s.17cct.com/v4/images/pic300.jpg', // 分享图标
			    success: function () { 
			        // 用户确认分享后执行的回调函数
			    },
			    cancel: function () { 
			    	//alert('11')
			        // 用户取消分享后执行的回调函数
			    }
			});	 
			wx.onMenuShareAppMessage({
			    title: '成为车堂盛世VIP门店', // 分享标题
			    desc: '成为车堂盛世VIP门店', // 分享描述
			    link: 'http://m.17cct.com/index/index.html', // 分享链接
			    imgUrl: 'http://s.17cct.com/v4/images/pic300.jpg', // 分享图标
			    type: 'link', // 分享类型,music、video或link，不填默认为link
			    dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
			    success: function () { 
			        // 用户确认分享后执行的回调函数
			    },
			    cancel: function () { 
			        // 用户取消分享后执行的回调函数
			    }
			}); 
		
		});


	
	//获取卡券列表
	function choosecard(){
			wx.chooseCard({
		    shopId: '', // 门店Id
		    cardType: '', // 卡券类型
		    cardId: '', // 卡券Id
		    timestamp: '<{$time}>', // 卡券签名时间戳
		    nonceStr: '<{$nonceStr}>', // 卡券签名随机串
		    signType: 'SHA1', // 签名方式，默认'SHA1'
		    cardSign: '<{$signature}>', // 卡券签名
		    success: function (res) {
  				 var choose_card_info = JSON.parse(res.cardList);
                // alert(choose_card_info);
                if (choose_card_info[0].card_id) {
                    coupon_used_id = choose_card_info[0].card_id;
                    // alert(coupon_used_id);
                    var coupon_encrypt = choose_card_info[0].encrypt_code;
                      /*$.ajax({
                        type: 'post',
                        url: '<{:U("Test/getcard")}>',
                        data: {
                            card_id: choose_card_info[0].card_id
                        },
                        dataType: 'json',
                        success: function(da) {
                             alert(JSON.stringify(da));



                          if (da.errmsg == 'ok') {
                                if (goods_total_money < (da.card.cash.least_cost) / 100) {
                                    alert('对不起,您买的商品不满' + (da.card.cash.least_cost) / 100 + '元,请选择其他优惠券');
                                } else {
                                    coupon_used_name = da.card.cash.base_info.title;
                                    // alert(coupon_used_name);
                                    coupon_used_id = da.card.cash.base_info.id;
                                    coupon_total_money = (da.card.cash.reduce_cost) / 100;
                                    $("#coupon_total_money").text(coupon_total_money.toFixed(2));
                                    getPayMoney();
                                }
                            }
                        }
                    });*/

                    $.ajax({        //取得卡的真正唯一序列号
                        type: 'post',
                        url: '<{:U("Test/getCode")}>',
                        data: {
                            encrypt_code: coupon_encrypt
                        },
                        dataType: 'json',
                        success: function(data1) {
                            if (data1.data.errmsg == 'ok') {
                                coupon_code = data1.data.code;
                               // alert(coupon_code);
                                var r=confirm("确定使用？")
								  if (r==true)
								    {
								       $.ajax({  //核销卡号
					                        type: 'post',
					                        url: '<{:U("Test/consume")}>',
					                        data: {
					                            code:coupon_code
					                        },
					                        dataType: 'json',
					                        success: function(d) {				      
					                            if (d.data.errmsg == 'ok') {
					                                alert(d.data.openid);
					                            }
					                        }
					                    }) 
								    }
								  else
								    {
								   	 alert("You pressed Cancel!")
								    }
                            }
                        }
                    }) 
                }
		    }
		});
	}

	//网络类型
	function networktype(){
		wx.getNetworkType({
			    success: function (res) {
			        var networkType = res.networkType; // 返回网络类型2g，3g，4g，wifi
			        alert(networkType);
			    }
			});
	}
	//隐藏右上角
	function hideOptionMenu(){
		wx.hideOptionMenu();
	}
	//显示右上角
	function showOptionMenu(){
		wx.showOptionMenu();
	}
	//开始录音
	function starvoice(){
		wx.startRecord({
	      cancel: function () {
		        alert('用户拒绝授权录音');
		      }
	    });
	}
	//停止录音
	function stoprecord(){
		wx.stopRecord({
		    success: function (res) {
		         localId = res.localId;
		    }
		});
	}
	//播放录音
	function playvoice(){
		wx.playVoice({
		    localId:localId // 需要播放的音频的本地ID，由stopRecord接口获得
		});
	}
	//暂停音频
	function pausevoice(){
		wx.pauseVoice({
		    localId: localId // 需要暂停的音频的本地ID，由stopRecord接口获得
		});
	}
	//停止音频
	function stopvoice(){
		wx.stopRecord({
		    success: function (res) {
		        var localId = res.localId;
		    }
		});
	}
	//查看位置
	function openLocation(){
		wx.openLocation({
		    latitude:21, // 纬度，浮点数，范围为90 ~ -90
		    longitude: 118, // 经度，浮点数，范围为180 ~ -180。
		    name: '南宁', // 位置名
		    address: '科园大道', // 地址详情说明
		    scale: 1, // 地图缩放级别,整形值,范围从1~28。默认为最大
		    infoUrl: 'http://www.17cct.com' // 在查看位置界面底部显示的超链接,可点击跳转
		});
	}
	//获取地理位置
	function getlocation(){
		wx.getLocation({
		    success: function (res) {
		        var latitude = res.latitude; // 纬度，浮点数，范围为90 ~ -90
		        var longitude = res.longitude; // 经度，浮点数，范围为180 ~ -180。
		        var speed = res.speed; // 速度，以米/每秒计
		        var accuracy = res.accuracy; // 位置精度
		        alert(accuracy);
		    }
		});
	}
	//检查接口
	function checkjsapi(){
		wx.checkJsApi({
	    jsApiList: ['chooseImage'], // 需要检测的JS接口列表，所有JS接口列表见附录2,
	    success: function(res) {
	        // 以键值对的形式返回，可用的api值true，不可用为false
	        // 如：{"checkResult":{"chooseImage":true},"errMsg":"checkJsApi:ok"}
	    	}
	    });
	}
	//拍照选择照片
	function chooseImg(){
		wx.chooseImage({
		    success: function (res) {
		        var localIds = res.localIds; // 返回选定照片的本地ID列表，localId可以作为img标签的src属性显示图片
		    }
		});
	}
	//扫一扫
	function scanQRCode(){
			wx.scanQRCode({
			    needResult: 1, // 默认为0，扫描结果由微信处理，1则直接返回扫描结果，
			    scanType: ["qrCode","barCode"], // 可以指定扫二维码还是一维码，默认二者都有
			    success: function (res) {
			    var result = res.resultStr; // 当needResult 为 1 时，扫码返回的结果
			}
		});
	}
	
	

</script>
</body>
</html>