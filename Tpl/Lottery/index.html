<include file="Inc:header"/>
</head>


<link rel="stylesheet" type="text/css" href="__PUBLIC__/css/reset.css" />
<style>
	body{background: #fbe3cc;}
	.g-content {
		width: 100%;
		padding-top: 15px;
		font-family: "微软雅黑", "microsoft yahei";
	}
	.g-content .g-lottery-case {
		height: 338px;
		overflow: hidden;
	}
	
	.g-content .g-lottery-case .g-left h2 {
		font-size: 20px;
		line-height: 32px;
		font-weight: normal;
		margin-left: 20px;
	}
	
	.g-content .g-lottery-case .g-left {
	}
	
	.g-lottery-box {
		width: 318px;
		height: 318px;
		margin:0 auto;
		position: relative;
		background: url(__PUBLIC__/images/lottery/ly-plate-c.gif) no-repeat;
	}
	
	.g-lottery-box .g-lottery-img {
		width: 270px;
		height: 270px;
		position: relative;
		background: url(__PUBLIC__/images/lottery/bg-lottery.png) no-repeat;
		left: 24px;
		top: 23px;
	}
	
	.g-lottery-box .playbtn {
		width: 155px;
		height: 155px;
		position: absolute;
		top: 57px;
		left: 57px;
		background: url(__PUBLIC__/images/lottery/playbtn.png) no-repeat;
	}
	.contentbox{    padding: 12px;  margin: 0 12px 70px 12px; background: #f7912f; color: #fff;border-radius: 5px;}
	.btnbg{    top: 0px;  left: 0px;  width: 100%;   height:100%; position: absolute;    z-index: 9990;
        background: #000;
    background: rgba(0,0,0,0.4);
    filter: alpha(opacity=40);}
	
	.c_title{text-align: center;  background: #f7542f;  padding: 8px;  font-weight: bold;  border-radius: 5px;}
	.c_tb tr td{border: 0 !important;}

	#shangfan{line-height: 24px;  height: 96px;  border: solid 1px #fff;  overflow: hidden;  margin: 10px auto;  background: #fbe3cc; font-size: 12px;
    border-radius: 5px;}
	#shangfan ul{margin: 0px 10px;padding: 0px;}
	#shangfan ul li{list-style-type: none; color: #656565;overflow:hidden; text-overflow:ellipsis; white-space: nowrap;margin:0;padding: 0px;}
	#shangfan ul li span{ float:right;}
</style>

</head>

<body style="position:relative;">
<div class="g-content">
	<div class="g-lottery-case">
		<div class="g-left">			
			<div class="g-lottery-box">
				<div class="g-lottery-img">
					<a class="playbtn" href="javascript:;" title="开始抽奖"></a>
				</div>
			</div>
		</div>
	</div>
</div>


<div class="contentbox">
<p class="c_title">中奖名单</p>

<div id="shangfan">
	<div id="holder">
		<ul>
		<volist name="user_list" id="ul">
			<li><span><{$ul.add_time|date="m-d",###}></span><{$ul.mobile}>抽中了<{$ul.prize}></li>
		</volist>
			
		</ul>
	</div>
</div>

<p class="c_title">奖项设置</p>

<table class="c_tb table">
	<tr>
		<td width="60" valign="top">一等奖</td>
		<td valign="top">价值4380元华为AL10手机一台(3名)。</td>
	</tr>
	<tr>
		<td valign="top">二等奖</td>
		<td valign="top">价值1980元兰博基尼香水跑车1台(10名)。</td>
	</tr>
	<tr>
		<td valign="top">三等奖</td>
		<td valign="top">价值798元冷暖坐垫一套(10名)。</td>
	</tr>
	<tr>
		<td valign="top">四等奖</td>
		<td valign="top">价值398元车宝堂臭氧消毒空气净化器(20名)。</td>
	</tr>
	<tr>
		<td valign="top">五等奖</td>
		<td valign="top">价值380元香水1个(20名)。</td>
	</tr>
	<tr>
		<td valign="top">幸运奖</td>
		<td valign="top">价值168元手机支架1个(39名)。</td>
	</tr>
</table>


<p class="c_title">活动说明</p>


<table class="c_tb table">
	<tr>
		<td width="73" valign="top">活动时间</td>
		<td valign="top">截止2017年1月25日。</td>
	</tr>
	<tr>
		<td valign="top">活动对象</td>
		<td valign="top">购买了车宝堂,D驾族新年美容套餐者可参与一次抽奖。</td>
	</tr>
	<tr>
		<td valign="top">活动流程</td>
		<td valign="top">由店长输入抽奖密码后抽奖,抽奖所得奖品现场兑换。</td>
	</tr>
	<tr>
		<td valign="top">活动说明</td>
		<td valign="top">本活动解释权归车堂盛世所有。</td>
	</tr>
</table>


</div>


<div class="btnbg" style="display:none"></div>

<div class="password"  style="display:none;position: fixed;padding: 15px;  height: 184px; width:290px; margin-top: -92px;  top:40%; z-index:9999;left: 50%;  margin-left: -145px;">
	<div class="panel panel-default">
		<div class="panel-heading">请让店长输入密码获取抽奖权限</div>
		<div class="panel-body">
			<center><input type="password" class="input" id="location_password" value=""></center>
		</div>
		<div class="panel-footer">
			<center><a class="btn btn-danger" id="submit">确定</a><a class="btn btn-info" id="cancel" style="margin-left:10px;">取消</a></center>
		</div>
	</div>
</div>






<script type="text/javascript" >
	
function marquee(height,speed,delay){
var scrollT;
var pause = false;
var ScrollBox = document.getElementById("shangfan");
if(document.getElementById("holder").offsetHeight <= height) return;
var _tmp = ScrollBox.innerHTML.replace('holder', 'holder2')
ScrollBox.innerHTML += _tmp;
ScrollBox.onmouseover = function(){pause = true}
ScrollBox.onmouseout = function(){pause = false}
ScrollBox.scrollTop = 0;
function start(){
     scrollT = setInterval(scrolling,speed);
     if(!pause) ScrollBox.scrollTop += 2;
}
function scrolling(){
     if(ScrollBox.scrollTop % height != 0){
         ScrollBox.scrollTop += 2;
         if(ScrollBox.scrollTop >= ScrollBox.scrollHeight/2) ScrollBox.scrollTop = 0;
     }
   else{
         clearInterval(scrollT);
         setTimeout(start,delay);
     }
}
setTimeout(start,delay);
}
marquee(48,10,3000);

</script>



<script src="__PUBLIC__/js/jquery-1.7.2.min.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="__PUBLIC__/js/jquery.rotate.min.js"></script>
<script type="text/javascript" src="__PUBLIC__/js/layer.js"></script>
<script>
	$(function() {
		var $btn = $('.playbtn');
		
		var isture = 0;
		// var clickfunc = function() {
		// 	var data = [1, 2, 3, 4, 5, 6];
		// 	//data为随机出来的结果，根据概率后的结果
		// 	data = data[Math.floor(Math.random() * data.length)];
		// 	switch(data) {
		// 		case 1:
		// 			rotateFunc(1, 0, '恭喜您获得价值4380元华为AL10手机一台!');
		// 			break;
		// 		case 2:
		// 			rotateFunc(2, 60, '恭喜您获得价值1980元兰博基尼香水跑车1台');
		// 			break;
		// 		case 3:
		// 			rotateFunc(3, 120, '恭喜您获得价值798元冷暖坐垫一套');
		// 			break;
		// 		case 4:
		// 			rotateFunc(4, 180, '恭喜您获得价值398元车宝堂臭氧消毒空气净化器');
		// 			break;
		// 		case 5:
		// 			rotateFunc(5, 240, '恭喜您获得价值380元香水1个');
		// 			break;
		// 		case 6:
		// 			rotateFunc(6, 300, '恭喜您获得价值168元手机支架1个');
		// 			break;
		// 	}
		// }
		$('#submit').click(function(){
			if($('#location_password').val()==''){
				$('#location_password').focus();
			}else{
				$.ajax({ 
				        type:"post",
				        data:{'pass':$('#location_password').val()},
				        url: "<{:U('Lottery/set_location_pass')}>",
				        success: function(d){
				         	layer.msg(d.info);
				         	if(d.status){
				         		$('.btnbg,.password').hide();
				         	}
				        }
				    })
			}
		})
		$('#cancel').click(function(){
			$('.btnbg,.password').hide();
			$('#location_password').val('')
		})
		$('.playbtn').click(function() {
			if(isture) return; // 如果在执行就退出
			isture = true; // 标志为 在执行
			//先判断是否登录,未登录则执行下面的函数			
			$.ajax({ 
		        type:"post",
		        url: "<{:U('Lottery/get_activity_prize')}>",
		        success: function(d){
		           if(d.status==0){
						  /*layer.prompt({title: '请让店长输入密码获取抽奖权限', formType: 1}, function(text, index){						    	    
							  		$.ajax({ 
								        type:"post",
								        data:{'pass':text},
								        url: "<{:U('Lottery/set_location_pass')}>",
								        success: function(d){
								         	layer.msg(d.info);
								         	layer.close(index);
								        }
								    })
						  })*/
						  $('#location_password').val('');
						  $('.btnbg,.password').show();						
		           }else if(d.status==-1){
		           		layer.msg(d.info);

		           }else{
		           		rotateFunc(d.status,d.data,d.info);
		           }
		           isture = false;
		        },
		        error:function(XMLHttpRequest, textStatus, errorThrown){
		        }
		    });

		

		});
		var rotateFunc = function(awards, angle, text) {
			isture = true;
			$btn.stopRotate();
			$btn.rotate({
				angle: 0,
				duration: 4000, //旋转时间
				animateTo: angle + 1440, //让它根据得出来的结果加上1440度旋转
				callback: function() {
					isture = false; // 标志为 执行完毕
					layer.alert(text+',马上联系门店领取吧。', {
					  title:'中奖信息',
					  width:'80%',
					  skin: 'layui-layer-molv' //样式类名
					  ,closeBtn: 0
					});
				}
			});
		};
	});
</script>

<include file="Inc:footer"/>
